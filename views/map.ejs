<%- include('partials/header'); -%>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
<script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
<script src="scripts/map.js"></script>
<% 
var viewDate = new Date().getDay();
var todayDate = new Date().getDay();
function compTime(time) {
    var a = time.split(':');
    var seconds = (+a[0]) * 60 * 60 + (+a[1]) * 60;
    var date = new Date();
    var dateTime = date.getHours() * 60 * 60 + date.getMinutes() * 60 + date.getSeconds();
    return seconds > dateTime;
}
%>
<div class="container row">
    <div class="col-2">
        <form action="/map" method="POST">
            <label class="control-label">Location</label>
            <select class="form-control" v-model="section" name="destination">
                <% locations.forEach(function(location){
                <option value="<%= location.name %>"><%= location.name %></option>
                <% }) %>
            </select>
            <button
                onclick="route('<%= destination.lat %>', '<%= destination.long %>', '<%= destination.images[0] %>')">Route</button>
        </form>
    </div>
    <div id="map" class="col-6"></div>
    <% if(currentUser && currentUser.schedule.length > 0) { %>
    <div class="col-4" id="schedule">
        <div class="d-flex justify-content-center">
            <h3>Today's Classes</h3>
            <% if(viewDate == todayDate){ %>
            <button class="btn btn-primary" onclick="'<% viewDate += 1 %>'">View Tomorrow's
                Classes</button></span>
            <% } %>
            <% if(viewDate != todayDate){ %>
            <button class="btn btn-primary" onclick="'<% viewDate -= 1 %>'">View Today's Classes</button></span>
            <% } %>
        </div>
        <% currentUser.schedule.forEach(function(course){ %>
        <% if(course.days.includes(viewDate) && compTime(course.startTime)){ %>
        <% var building = locations.find(({ name }) => name === course.location) %>
        <div class="row">
            <span><%= course.name %> - <%= course.location %></span>
            <span><%= course.startTime %> - <%= course.endTime %></span>
            <span><button class="btn btn-primary"
                    onclick="route('<%= building.lat %>', '<%= building.long %>', '<%= building.images[0] %>')">Directions</a></span>
        </div>
        </br>
        <% }}) %>
        <div id="route"></div>
    </div>

    <% } else {%>
    <div class="col-4">
        <h4>Login to View Directions to Your Classes</h4>
        <a class="btn btn-primary" href="login">Login</a>
    </div>

    <% } %>
</div>

<%- include ('partials/footer'); -%>